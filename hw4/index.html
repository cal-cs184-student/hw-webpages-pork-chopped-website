<html>
	<head>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=default'></script>
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
		<style>
			h1 {
				text-align: center;
			}

			.container {
				margin: 0 auto;
				padding: 60px 20%;
			}

			figure {
				text-align: center;
			}

			img {
				display: inline-block;
			}

			body {
				font-family: 'Inter', sans-serif;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>CS184/284A Spring 2025 Homework 4 Write-Up</h1>
			<div style="text-align: center;">Names: Karson Du, Patrick Sanchez </div>

			<br>

			Link to webpage: <a href="https://cal-cs184-student.github.io/hw-webpages-pork-chopped-website/hw4/index.html">https://cal-cs184-student.github.io/hw-webpages-pork-chopped-website/hw4/index.html</a>

			<br>

			Link to GitHub repository: <a href="https://github.com/cal-cs184-student/sp25-hw4-lebron">https://github.com/cal-cs184-student/sp25-hw4-lebron</a>

			<figure>
				<img src="clothsim.png" alt="Cloth draped over sphere" style="width:70%" />
				<figcaption>&#128514;</figcaption>
			</figure>

			<!--
	We've already added one heading per part, to make your write-up as navigable when grading. Please fit your write-up within these sections!
	-->

			<h2>Overview</h2>
			Give a high-level overview of what you implemented in this homework. Think about what you've built as a whole. Share your thoughts on what interesting things you've learned from completing the homework.

			<h2>Part 1: Masses and springs</h2>


			<div style="display: flex; flex-direction: column; align-items: center;">
				<table style="width: 100%; text-align: center; border-collapse: collapse;">
					<tr>
						<td style="text-align: center;">
							<img src="scene_pinned2.png" width="400px" />
							<figcaption>Pinned2 Scene</figcaption>
						</td>
						<td style="text-align: center;">
							<img src="NoShear.png" width="400px" />
							<figcaption>Without any Shearing Constraints</figcaption>
						</td>
					</tr>
					<tr>
						<td style="text-align: center;">
							<img src="OnlyShear.png" width="400px" />
							<figcaption>With only Shearing Constraint</figcaption>
						</td>
						<td style="text-align: center;">
							<img src="AllConstraints.png" width="400px" />
							<figcaption>With all Constraints</figcaption>
						</td>
					</tr>
				</table>
			</div>

			<h2>Part 2: Simulation via numerical integration</h2>
			<p>For Part 2, we incorporate two forces for simulation. The first, external forces (e.g. gravity), and the second, spring correction forces.</p>
			<p>We first begin by calculating force acting on each point mass. For external forces acting on each point mass, we follow \(F = ma\). Then, for every spring, we calculate spring correction forces with \(F_s = k_s \cdot ( \| p_a - p_b \| - l )\), where \(k_s\) is the spring constant, \(p_a\) & \(p_b\) are the end positions of our spring, and \(l\) is the length of the spring.</p>
			<p>For every point mass that is not pinned, we apply the forces to each using Verlet Integration with a damping factor to account for energy loss from friction, heat, etc.:</p>

			<p>\[x_{t+\Delta t}=x_t+(1-d)\cdot\bigl(x_t-x_{t-\Delta t}\bigr)+a_t\cdot\Delta t^2\]</p>

			<ul>
				<li>\(x_t\): position</li>
				<li>\(d\): damping term [0%,1%] to simulate energy loss.</li>
				<li>\(a_t\): current acceleration from all forces</li>
				<li>\(\Delta t\): time step (delta_t)</li>
			</ul>

			<p>Then to limit the spring deformation and stretch to reasonable amounts, any pair of unpinned point masses are constrained and corrected towards at most 10% greater than the spring rest length.</p>

				<div style="display: flex; flex-direction: column; align-items: center;">
					<table style="width: 100%; text-align: center; border-collapse: collapse;">
						<tr>
							<td style="text-align: center;">
								<img src="p2/2.1 500 ks.png" width="400px" />
								<figcaption>Low spring constant</figcaption>
							</td>
							<td style="text-align: center;">
								<img src="p2/2.1.1 500 ks swing.png" width="400px" />
								<figcaption>Low spring constant, mid swing</figcaption>
							</td>
						</tr>
						<tr>
							<td style="text-align: center;">
								<img src="p2/2.2 50000 ks.png" width="400px" />
								<figcaption>High spring constant</figcaption>
							</td>
							<td style="text-align: center;">
								<img src="p2/2.2.1 50000 ks swing.png" width="400px" />
								<figcaption>High spring constant, mid swing</figcaption>
							</td>
						</tr>
						<tr>
							<td style="text-align: center;">
								<img src="p2/2.3 15 gpermsq.png" width="400px" />
								<figcaption>low density</figcaption>
							</td>
							<td style="text-align: center;">
								<img src="p2/2.3.1 15 gpermsq swing.png" width="400px" />
								<figcaption>low density, mid swing</figcaption>
							</td>
						</tr>
						<tr>
							<td style="text-align: center;">
								<img src="p2/2.4 1500 gpermsq.png" width="400px" />
								<figcaption>high density</figcaption>
							</td>
							<td style="text-align: center;">
								<img src="p2/2.4.1 1500 gpermsq swing.png" width="400px" />
								<figcaption>high density, mid swing</figcaption>
							</td>
						</tr>
						<tr>
							<td style="text-align: center;">
								<img src="p2/2.5 0 damp.png" width="400px" />
								<figcaption>0% force dampening</figcaption>
							</td>
							<td style="text-align: center;">
								<img src="p2/2.6 100 damp.png" width="400px" />
								<figcaption>1% force dampening</figcaption>
							</td>
						</tr>
						<tr>
							<td style="text-align: center;">
								<img src="p2/2.7 pinned4 shaded.png" width="400px" />
								<figcaption>Default settings, 4 corners pinned</figcaption>
							</td>
						</tr>
					</table>
				</div>

				<p>Adjusting the properties of the fabric results in a few notable differences. Lower spring constants resulted in the fabric stretching more, as it drapes lower and swings with more pronounced waves. The higher spring constants appear more rigid in rest and in motion. The low density fabric folds over relaxed with one larger crease at the top compared to the high density fabric, which experienced bowing on the sides due to higher tension as well as tighter upper folds. With no dampening, the fabric's motion was chaotic, as it conserved all the energy converted from potential to kinetic with volatile ripples and great swings. The fabric with the full 1% dampening fell down rather elegantly, although slower than would be expected with Earth's gravity, there was little to no over-swing, as it reached a near rest position by the first one. The final example of fabric simulation with all four corners pinned sits comfortably, as each corner's tension causes diagonal peaks, with smooth valleys resting between each.</p>

				<h2>Part 3: Handling collisions with other objects</h2>
				<div style="display: flex; flex-direction: column; align-items: center;">
					<table style="width: 100%; text-align: center; border-collapse: collapse;">
						<tr>
							<td style="text-align: center;">
								<img src="Part3KS500.png" width="400px" />
								<figcaption>KS of 500</figcaption>
							</td>
							<td style="text-align: center;">
								<img src="Part3KS5000.png" width="400px" />
								<figcaption>KS of 5000</figcaption>
							</td>
							<td style="text-align: center;">
								<img src="Part3KS50000.png" width="400px" />
								<figcaption>KS of 50000</figcaption>
							</td>
						</tr>
						<tr>
							<figure>
								<img src="Part3Plane.png" alt="Plane" style="width:50%" />
								<figcaption>Cloth lying peacefully at rest on the plane</figcaption>
							</figure>
						</tr>
					</table>
				</div>
				<h2>Part 4: Handling self-collisions</h2>
				<p>Now that our cloth can handle simple collisions with planes and spheres, we arive at the question of how we simulate the cloth at a realistic resting state? To achieve this, we added self-collision functionality during simulation.</p>
				
			    <p>Firstly, we organize our point masses into 3D boxes, based on the point mass's position. The boxes have dimensions \( w \cdot h \cdot t \) determined via 3 equations: \( w = 3 \cdot width / num_width_points \), \( h = 3 \cdot height / num_height_points \), and \( t = max(w,h) \). Based on these number of points, the size of these adjacency boxes of point masses scale.</p>

				<p>Secondly, we iterate through all of the point masses inside our fabric to initialize a map that assigns each point mass to the unique identifier of its corresponding box.</p>

				<p>Thirdly, for every point mass, we check every other point mass within the shared adjacency box, and check if the two are within \( 2 \cdot thickness \) distance apart. If so, we start collecting up correctional forces from all the other point masses, then average them out to apply to the original input point mass to simulate the fabric pushing against itself (perfectly folded fabric could only be \(2 \cdot thickness \) wide).</p>
				
			<div style="display: flex; flex-direction: column; align-items: center;">
					<table style="width: 100%; text-align: center; border-collapse: collapse;">
						<tr>
							<td style="text-align: center;">
								<img src="p4/4.1 Before.png" width="400px" />
								<figcaption>Standing cloth before drop</figcaption>
							</td>
							<td style="text-align: center;">
								<img src="p4/4.1 Before 1500 gpermsq.png" width="400px" />
								<figcaption>High density cloth, same setup</figcaption>
							</td>
						</tr>
						<tr>
							<td style="text-align: center;">
								<img src="p4/4.1 Before 500ks.png" width="400px" />
								<figcaption>Low spring constant, same setup</figcaption>
							</td>
							<td style="text-align: center;">
								<img src="p4/4.1 Before 50000ks.png" width="400px" />
								<figcaption>High spring constant, same setup</figcaption>
							</td>
						</tr>
						<tr>
							<td style="text-align: center;">
								<img src="p4/4.2 During.png" width="400px" />
								<figcaption>Default cloth self-colliding</figcaption>
							</td>
							<td style="text-align: center;">
								<img src="p4/4.2 During 1500 gpermsq.png" width="400px" />
								<figcaption>High density cloth self-colliding</figcaption>
							</td>
						</tr>
						<tr>
							<td style="text-align: center;">
								<img src="p4/4.2 During 500ks.png" width="400px" />
								<figcaption>Low spring constant cloth self-colliding</figcaption>
							</td>
							<td style="text-align: center;">
								<img src="p4/4.2 During 50000ks.png" width="400px" />
								<figcaption>High spring constant cloth self-colliding</figcaption>
							</td>
						</tr>
						<tr>
							<td style="text-align: center;">
								<img src="p4/4.3 After.png" width="400px" />
								<figcaption>Default cloth at "rest"</figcaption>
							</td>
							<td style="text-align: center;">
								<img src="p4/4.3 After 1500 gpermsq.png" width="400px" />
								<figcaption>High density cloth at "rest"</figcaption>
							</td>
						</tr>
						<tr>
							<td style="text-align: center;">
								<img src="p4/4.3 After 500ks.png" width="400px" />
								<figcaption>Low spring constant cloth at "rest"</figcaption>
							</td>
							<td style="text-align: center;">
								<img src="p4/4.3 After 50000ks.png" width="400px" />
								<figcaption>High spring constant cloth at "rest"</figcaption>
							</td>
						</tr>
					</table>
				</div>

			<p>From a qualitative standpoint, it is no question that all of the above settings for the fabric begin at the same state. However, during simulation of self-collision, there are some noticable differences in the way the fabric interacts with itself. The default fabric has medium folds, with ripples traveling partially up the fabric as it is pulled downwards by gravity. The increased density fabric folds into smaller creases, and has less ripple effects presumably due to the increased force required to move the fabric. Comparing the low spring vs high spring constant cases, the higher the spring constant (more rigid), the larger the folds as the springs resist creasing with high tension.</p>

			<p>By the time the fabrics are all laid out on the plane, the influences of the fabric parameters still have some nuance. The default fabric lays somewhat comfortably with some ripples. The high density fabric on the other hand has tighter folds, with ripples left over from the random unwavering drop. Finally, the more rigid fabric with tighter spring forces is pulled into a smoother texture with no ripples, whereas lower spring forces left the fabric in a contorted rest position.</p>

				<h2>Part 5: Shaders</h2>
				Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

				<h2>(Optional) Part 6: Extra Credit - Additional cloth simulation features!</h2>

		</div>
	</body>
</html>